{
  "meta": {
    "title": "Bakker UI Stability, Logs Clarity, Branding",
    "created": "2026-02-04",
    "updated": "2026-02-04",
    "source": "mise-en-place",
    "seed": "prompt"
  },
  "vision": {
    "problem": "Header layout shifts when auth hints appear, logs are missing after manual backups, and branding is inconsistent.",
    "audience": "Self-hosters running Bakker via Docker who want stable UI, reliable logs, and consistent branding.",
    "success": "Header height is stable, logs appear going forward and stay concise, and UI branding uses bakker in title and top nav."
  },
  "scope": {
    "in": [
      "Prevent header layout shift by removing inline auth hint and using toast guidance",
      "Ensure manual backups append to /data/logs/backup.log (going forward only)",
      "Keep logs concise by emitting high-level info-only events",
      "Update document title and top nav branding to bakker"
    ],
    "out": [
      "Backfilling or reconstructing past logs from 0.1.3",
      "Changing API shapes or adding new endpoints",
      "Rewriting backup scripts beyond log routing"
    ]
  },
  "user_flow": [
    "Discovery: open UI and see stable header",
    "Onboarding: auth required prompts via toast without layout shift",
    "Core loop: configure DBs, run backups, view logs",
    "Exit/return: branding consistent across sessions"
  ],
  "features": [
    {
      "id": "F-001",
      "name": "Stable header with toast-only auth guidance",
      "description": "Prevent top-bar height changes by removing inline auth hint and using toasts for auth-required guidance.",
      "inputs": ["auth state", "token entry", "auth errors"],
      "outputs": ["toast messages", "fixed header layout"],
      "edge_cases": ["missing token", "invalid token", "auth not required"]
    },
    {
      "id": "F-002",
      "name": "Forward-only concise logs",
      "description": "Ensure manual backup output is appended to /data/logs/backup.log and log entries are concise info-level events only.",
      "inputs": ["backup stdout/stderr", "log file path"],
      "outputs": ["log file content visible in UI"],
      "edge_cases": ["logs directory missing", "log file missing", "backup failure"]
    },
    {
      "id": "F-003",
      "name": "Bakker branding in UI",
      "description": "Update document title and top nav brand text to bakker.",
      "inputs": ["static HTML/JS"],
      "outputs": ["updated title and header brand"],
      "edge_cases": ["none"]
    }
  ],
  "requirements": {
    "functional": [
      "Header height remains constant when auth guidance is shown",
      "Missing or invalid token produces a toast message",
      "Manual backup output is appended to /data/logs/backup.log",
      "Logs view shows new entries after manual and scheduled backups",
      "Log entries are concise info-level events (no verbose debug spam)",
      "Document title and top nav branding use bakker"
    ],
    "non_functional": [
      "No layout shift in header when auth state changes",
      "Logs stay readable and uncluttered",
      "No new dependencies"
    ]
  },
  "data_model": [
    {
      "entity": "LogFile",
      "fields": ["/data/logs/backup.log"],
      "relationships": ["Written by backup.sh (cron) and manual backup runner", "Read by /api/logs"]
    }
  ],
  "integrations": [
    {
      "name": "Cron",
      "purpose": "Scheduled backups append to log file",
      "constraints": "System crontab entries include a username field; entries end with newline"
    }
  ],
  "design": {
    "style": "Keep current visual system; stability change only",
    "references": [
      "web.dev CLS guidance",
      "crontab(5) system file format",
      "syslog severity definitions"
    ]
  },
  "tech_stack": {
    "frontend": "Static HTML/CSS/JS",
    "backend": "Bun server (server/index.ts)",
    "db": "MariaDB/MySQL (backups only)",
    "auth": "Bearer token via AUTH_TOKEN",
    "hosting": "Docker",
    "realtime": "None",
    "other": ["cron", "shell scripts"]
  },
  "risks": [
    "Log file path missing or not writable inside container",
    "Toast guidance could be too frequent if triggered on every request"
  ],
  "research": [
    {
      "topic": "Avoiding layout shift from dynamic content",
      "summary": "Layout shifts are caused by injecting content without reserved space; use fixed containers or overlays to avoid shifting the page.",
      "sources": [
        "https://web.dev/articles/optimize-cls"
      ]
    },
    {
      "topic": "System crontab file format",
      "summary": "System crontabs (/etc/crontab and /etc/cron.d) include a username field after the five time fields and entries are newline-terminated.",
      "sources": [
        "https://man.he.net/man5/crontab",
        "https://man7.org/linux/man-pages/man5/crontab.5.html"
      ]
    },
    {
      "topic": "Log level semantics",
      "summary": "Syslog severity levels define informational messages as normal operational messages, with higher severity reserved for errors and critical conditions.",
      "sources": [
        "https://www.rfc-editor.org/rfc/rfc5424"
      ]
    }
  ],
  "tasks": [
    {
      "id": "T-001",
      "title": "Stabilize header + toast-only auth hints",
      "goal": "Prevent header height changes and move auth guidance to toast notifications.",
      "scope": "one iteration",
      "acceptance_criteria": [
        "Header height remains constant when auth guidance appears",
        "Missing token shows a toast message",
        "Invalid token shows an error toast",
        "No inline auth hint affects layout"
      ],
      "tracer_bullet": "Toggle auth-required state and verify no layout shift while toasts show",
      "dependencies": [],
      "status": "done",
      "notes": "Use existing toast system; do not reserve header space for hints."
    },
    {
      "id": "T-002",
      "title": "Forward-only concise logs",
      "goal": "Ensure manual backups append concise info-level lines to /data/logs/backup.log going forward.",
      "scope": "one iteration",
      "acceptance_criteria": [
        "Manual backup output appears in /api/logs",
        "Logs directory/file is created if missing",
        "Log entries are concise high-level info lines (start/success/error)"
      ],
      "tracer_bullet": "Trigger manual backup and confirm /api/logs shows concise new lines",
      "dependencies": [],
      "status": "done",
      "notes": "No backfill for 0.1.3 logs; only future runs."
    },
    {
      "id": "T-003",
      "title": "Update UI branding to bakker",
      "goal": "Use 'bakker' in document title and top nav brand.",
      "scope": "one iteration",
      "acceptance_criteria": [
        "Browser title shows bakker",
        "Top nav brand shows bakker"
      ],
      "tracer_bullet": "Reload UI and confirm title and header brand",
      "dependencies": [],
      "status": "done",
      "notes": "Limit scope to UI branding strings."
    }
  ]
}
